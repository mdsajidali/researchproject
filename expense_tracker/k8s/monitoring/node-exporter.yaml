apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-exporter
  namespace: monitoring
spec:
  selector: { matchLabels: { app: node-exporter } }
  template:
    metadata: { labels: { app: node-exporter } }
    spec:
      hostPID: true
      hostNetwork: true
      containers:
        - name: node-exporter
          image: quay.io/prometheus/node-exporter:v1.8.2
          args: [ "--path.rootfs=/host" ]
          ports: [ { name: metrics, containerPort: 9100 } ]
          volumeMounts: [ { name: root, mountPath: /host, readOnly: true } ]
      volumes:
        - name: root
          hostPath: { path: /, type: Directory }
---
apiVersion: v1
kind: Service
metadata:
  name: node-exporter
  namespace: monitoring
spec:
  selector: { app: node-exporter }
  ports: [ { name: http, port: 9100, targetPort: metrics } ]
